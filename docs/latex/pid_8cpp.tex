\doxysection{Referencia del archivo src/pid.cpp}
\hypertarget{pid_8cpp}{}\label{pid_8cpp}\index{src/pid.cpp@{src/pid.cpp}}


Implementación del controlador Proporcional-\/\+Integral-\/\+Derivativo (PID).  


{\ttfamily \#include $<$Arduino.\+h$>$}\newline
{\ttfamily \#include "{}config.\+hpp"{}}\newline
{\ttfamily \#include "{}pid.\+hpp"{}}\newline
\doxysubsubsection*{Funciones}
\begin{DoxyCompactItemize}
\item 
float \mbox{\hyperlink{pid_8cpp_aaa3441d50a3a4f31e76e5014882b3a95}{calculo\+\_\+pid}} (uint16\+\_\+t pos, float delta\+Time)
\begin{DoxyCompactList}\small\item\em Realiza el cálculo del algoritmo PID. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{pid_8cpp_a02e48c71c98d7a877bf3f9d37b6d4c39}{reiniciar\+\_\+pid}} ()
\begin{DoxyCompactList}\small\item\em Reinicia las variables de estado del controlador. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
float \mbox{\hyperlink{pid_8cpp_aa816869ccf685e5813827a4dae362891}{last\+Error}} = 0
\begin{DoxyCompactList}\small\item\em Almacena el error de la iteración anterior para el cálculo de la parte derivativa. \end{DoxyCompactList}\item 
float \mbox{\hyperlink{pid_8cpp_a1174af01b8a329a6d465ea6e0951b3e5}{integral}} = 0
\begin{DoxyCompactList}\small\item\em Acumulador del error en el tiempo para el cálculo de la parte integral. \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{pid_8cpp_ae6951301aef881b2aafcbe3538a45148}{last\+Time}} = 0
\begin{DoxyCompactList}\small\item\em Almacena la marca de tiempo de la última ejecución (no utilizado en la versión actual). \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{pid_8cpp_ab2b0c78a81e045d7a8f28be307b8c61b}{base\+Speed}} = 70
\begin{DoxyCompactList}\small\item\em Velocidad crucero para NIGHTFALL (0-\/100\%). \end{DoxyCompactList}\item 
const float \mbox{\hyperlink{pid_8cpp_ae0fd140825889f1a7ed103b66c28ce38}{Ku}} = 0.\+065
\begin{DoxyCompactList}\small\item\em Ganancia última para NIGHTFALL. \end{DoxyCompactList}\item 
const float \mbox{\hyperlink{pid_8cpp_a38eca5301b0c8380eaea74f460237a09}{Tu}} = 0.\+350
\begin{DoxyCompactList}\small\item\em Periodo último para NIGHTFALL. \end{DoxyCompactList}\item 
const float \mbox{\hyperlink{pid_8cpp_a790f9df599f1d6c92855645c65a0cccc}{Kp}} = 0.\+6 \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{pid_8cpp_ae0fd140825889f1a7ed103b66c28ce38}{Ku}}
\begin{DoxyCompactList}\small\item\em Ganancia Proporcional según sintonización clásica de Ziegler-\/\+Nichols (0.\+6 \texorpdfstring{$\ast$}{*} Ku). \end{DoxyCompactList}\item 
const float \mbox{\hyperlink{pid_8cpp_a0534f74e5e04a4433256a6d9bb982d2e}{Ki}} = 2 \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{pid_8cpp_a790f9df599f1d6c92855645c65a0cccc}{Kp}} / \mbox{\hyperlink{pid_8cpp_a38eca5301b0c8380eaea74f460237a09}{Tu}}
\begin{DoxyCompactList}\small\item\em Ganancia Integral calculada como $ 2 \cdot K_p / T_u $. \end{DoxyCompactList}\item 
const float \mbox{\hyperlink{pid_8cpp_ad76756e0056f2f5ec10057052cbed3c9}{Kd}} = \mbox{\hyperlink{pid_8cpp_a790f9df599f1d6c92855645c65a0cccc}{Kp}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{pid_8cpp_a38eca5301b0c8380eaea74f460237a09}{Tu}} / 8
\begin{DoxyCompactList}\small\item\em Ganancia Derivativa calculada como $ K_p \cdot T_u / 8 $. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Descripción detallada}
Implementación del controlador Proporcional-\/\+Integral-\/\+Derivativo (PID). 

Gestiona la selección de constantes por perfil de corredor y realiza el cálculo de la salida del controlador basándose en el error de posición de la línea. \begin{DoxyAuthor}{Autor}
Legion de Ohm 
\end{DoxyAuthor}


\label{doc-func-members}
\Hypertarget{pid_8cpp_doc-func-members}
\doxysubsection{Documentación de funciones}
\Hypertarget{pid_8cpp_aaa3441d50a3a4f31e76e5014882b3a95}\index{pid.cpp@{pid.cpp}!calculo\_pid@{calculo\_pid}}
\index{calculo\_pid@{calculo\_pid}!pid.cpp@{pid.cpp}}
\doxysubsubsection{\texorpdfstring{calculo\_pid()}{calculo\_pid()}}
{\footnotesize\ttfamily \label{pid_8cpp_aaa3441d50a3a4f31e76e5014882b3a95} 
float calculo\+\_\+pid (\begin{DoxyParamCaption}\item[{uint16\+\_\+t}]{pos}{, }\item[{float}]{delta\+Time}{}\end{DoxyParamCaption})}



Realiza el cálculo del algoritmo PID. 

Calcula la corrección necesaria para el sistema usando la fórmula PID.

Calcula el error respecto al setpoint, la tasa de cambio (derivada) y la acumulación del error (integral) para generar la señal de salida. 
\begin{DoxyParams}{Parámetros}
{\em pos} & Posición actual leída por el array de sensores. \\
\hline
{\em delta\+Time} & Tiempo transcurrido desde la última ejecución en segundos ( $ \Delta T $). \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
float Señal de corrección resultante de la suma ponderada de los tres términos. 
\end{DoxyReturn}
\Hypertarget{pid_8cpp_a02e48c71c98d7a877bf3f9d37b6d4c39}\index{pid.cpp@{pid.cpp}!reiniciar\_pid@{reiniciar\_pid}}
\index{reiniciar\_pid@{reiniciar\_pid}!pid.cpp@{pid.cpp}}
\doxysubsubsection{\texorpdfstring{reiniciar\_pid()}{reiniciar\_pid()}}
{\footnotesize\ttfamily \label{pid_8cpp_a02e48c71c98d7a877bf3f9d37b6d4c39} 
void reiniciar\+\_\+pid (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Reinicia las variables de estado del controlador. 

Resetea las variables internas del controlador (error acumulado y error anterior).

Pone a cero el error previo y el acumulador integral para evitar efectos de arrastre en nuevas activaciones del control. 

\label{doc-var-members}
\Hypertarget{pid_8cpp_doc-var-members}
\doxysubsection{Documentación de variables}
\Hypertarget{pid_8cpp_ab2b0c78a81e045d7a8f28be307b8c61b}\index{pid.cpp@{pid.cpp}!baseSpeed@{baseSpeed}}
\index{baseSpeed@{baseSpeed}!pid.cpp@{pid.cpp}}
\doxysubsubsection{\texorpdfstring{baseSpeed}{baseSpeed}}
{\footnotesize\ttfamily \label{pid_8cpp_ab2b0c78a81e045d7a8f28be307b8c61b} 
uint8\+\_\+t base\+Speed = 70}



Velocidad crucero para NIGHTFALL (0-\/100\%). 

Velocidad crucero nominal de los motores cuando el error es mayor a la zona muerta. \Hypertarget{pid_8cpp_a1174af01b8a329a6d465ea6e0951b3e5}\index{pid.cpp@{pid.cpp}!integral@{integral}}
\index{integral@{integral}!pid.cpp@{pid.cpp}}
\doxysubsubsection{\texorpdfstring{integral}{integral}}
{\footnotesize\ttfamily \label{pid_8cpp_a1174af01b8a329a6d465ea6e0951b3e5} 
float integral = 0}



Acumulador del error en el tiempo para el cálculo de la parte integral. 

\Hypertarget{pid_8cpp_ad76756e0056f2f5ec10057052cbed3c9}\index{pid.cpp@{pid.cpp}!Kd@{Kd}}
\index{Kd@{Kd}!pid.cpp@{pid.cpp}}
\doxysubsubsection{\texorpdfstring{Kd}{Kd}}
{\footnotesize\ttfamily \label{pid_8cpp_ad76756e0056f2f5ec10057052cbed3c9} 
const float Kd = \mbox{\hyperlink{pid_8cpp_a790f9df599f1d6c92855645c65a0cccc}{Kp}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{pid_8cpp_a38eca5301b0c8380eaea74f460237a09}{Tu}} / 8}



Ganancia Derivativa calculada como $ K_p \cdot T_u / 8 $. 

Constante Derivativa. \Hypertarget{pid_8cpp_a0534f74e5e04a4433256a6d9bb982d2e}\index{pid.cpp@{pid.cpp}!Ki@{Ki}}
\index{Ki@{Ki}!pid.cpp@{pid.cpp}}
\doxysubsubsection{\texorpdfstring{Ki}{Ki}}
{\footnotesize\ttfamily \label{pid_8cpp_a0534f74e5e04a4433256a6d9bb982d2e} 
const float Ki = 2 \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{pid_8cpp_a790f9df599f1d6c92855645c65a0cccc}{Kp}} / \mbox{\hyperlink{pid_8cpp_a38eca5301b0c8380eaea74f460237a09}{Tu}}}



Ganancia Integral calculada como $ 2 \cdot K_p / T_u $. 

Constante Integral. \Hypertarget{pid_8cpp_a790f9df599f1d6c92855645c65a0cccc}\index{pid.cpp@{pid.cpp}!Kp@{Kp}}
\index{Kp@{Kp}!pid.cpp@{pid.cpp}}
\doxysubsubsection{\texorpdfstring{Kp}{Kp}}
{\footnotesize\ttfamily \label{pid_8cpp_a790f9df599f1d6c92855645c65a0cccc} 
const float Kp = 0.\+6 \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{pid_8cpp_ae0fd140825889f1a7ed103b66c28ce38}{Ku}}}



Ganancia Proporcional según sintonización clásica de Ziegler-\/\+Nichols (0.\+6 \texorpdfstring{$\ast$}{*} Ku). 

Constante Proporcional. \Hypertarget{pid_8cpp_ae0fd140825889f1a7ed103b66c28ce38}\index{pid.cpp@{pid.cpp}!Ku@{Ku}}
\index{Ku@{Ku}!pid.cpp@{pid.cpp}}
\doxysubsubsection{\texorpdfstring{Ku}{Ku}}
{\footnotesize\ttfamily \label{pid_8cpp_ae0fd140825889f1a7ed103b66c28ce38} 
const float Ku = 0.\+065}



Ganancia última para NIGHTFALL. 

Ganancia última (Ultimate Gain). \Hypertarget{pid_8cpp_aa816869ccf685e5813827a4dae362891}\index{pid.cpp@{pid.cpp}!lastError@{lastError}}
\index{lastError@{lastError}!pid.cpp@{pid.cpp}}
\doxysubsubsection{\texorpdfstring{lastError}{lastError}}
{\footnotesize\ttfamily \label{pid_8cpp_aa816869ccf685e5813827a4dae362891} 
float last\+Error = 0}



Almacena el error de la iteración anterior para el cálculo de la parte derivativa. 

\Hypertarget{pid_8cpp_ae6951301aef881b2aafcbe3538a45148}\index{pid.cpp@{pid.cpp}!lastTime@{lastTime}}
\index{lastTime@{lastTime}!pid.cpp@{pid.cpp}}
\doxysubsubsection{\texorpdfstring{lastTime}{lastTime}}
{\footnotesize\ttfamily \label{pid_8cpp_ae6951301aef881b2aafcbe3538a45148} 
uint32\+\_\+t last\+Time = 0}



Almacena la marca de tiempo de la última ejecución (no utilizado en la versión actual). 

\Hypertarget{pid_8cpp_a38eca5301b0c8380eaea74f460237a09}\index{pid.cpp@{pid.cpp}!Tu@{Tu}}
\index{Tu@{Tu}!pid.cpp@{pid.cpp}}
\doxysubsubsection{\texorpdfstring{Tu}{Tu}}
{\footnotesize\ttfamily \label{pid_8cpp_a38eca5301b0c8380eaea74f460237a09} 
const float Tu = 0.\+350}



Periodo último para NIGHTFALL. 

Periodo de oscilación última (Ultimate Period). 